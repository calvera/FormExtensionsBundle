!function(e,i,t){function s(i,t){this.element=i,this.options=e.extend({},a,t),this._defaults=a,this._name=n,this._init()}var n="singleUpload",a=(i.document,{maxWidth:320,maxHeight:180,minWidth:16,minHeight:16,previewImages:!0,previewAsCanvas:!0,isEmpty:!0,nameable:!1,deleteable:!1,downloadable:!0,widget_name:null,filetypes:{audio:"Audio",archive:"Archive",html:"HTML",image:"Image","pdf-document":"PDF<br />Document","plain-text":"Plain<br />Text",presentation:"Presentation",spreadsheet:"Spreadsheet","text-document":"Text<br />Document",unknown:"Unknown<br />Filetype",video:"Video"}});s.prototype={_init:function(){var i=this;this.$widgetContainer=e("#"+this.element.id+"_widget_container"),this.$addButton=this.$widgetContainer.find(".singleupload-buttonbar .add"),this.$replaceButton=this.$widgetContainer.find(".singleupload-buttonbar .replace"),this.$cancelButton=this.$widgetContainer.find(".singleupload-buttonbar .cancel"),this.$downloadButton=this.$widgetContainer.find(".singleupload-buttonbar .download"),this.$deleteButton=this.$widgetContainer.find(".singleupload-buttonbar .delete"),this.isDeletable=!this.options.isEmpty&&this.options.deleteable,this.isDownloadable=!this.options.isEmpty&&this.options.downloadable,this.options.deleteable&&(this.$deleteFlag=e("#"+this.element.id+"_delete")),this.isDownloadable&&this.$downloadButton.show(),this.isDeletable&&this.$deleteButton.show(),this._resetInput(),e(this.element).on("change",function(){i._onChange()}),this.$cancelButton.click(function(){i._onCancel()}),this.$deleteButton.click(function(){i._onDelete()})},_onChange:function(){var e=this.element.files[0];return e?(this.$cancelButton.removeClass("disabled").show("slide",{direction:"left"},"slow"),this.isEmpty&&(this.$addButton.hide(),this.$replaceButton.show()),this.isDownloadable&&this.$downloadButton.addClass("disabled").hide("slide",{direction:"right"},"slow"),this.isDeletable&&this.$deleteButton.addClass("disabled").hide("slide",{direction:"right"},"slow"),void(this.options.previewImages&&this._isImage(e)?this._onPreviewImage():this._onPreviewFile())):void this._onCancel()},_onCancel:function(){this.$cancelButton.addClass("disabled").hide("slide",{direction:"left"},"slow"),this.isEmpty&&(this.$replaceButton.hide(),this.$addButton.show()),this.isDownloadable&&!this.isEmpty&&this.$downloadButton.removeClass("disabled").show("slide",{direction:"right"},"slow"),this.isDeletable&&!this.isEmpty&&this.$deleteButton.removeClass("disabled").show("slide",{direction:"right"},"slow");var i=e("."+this.element.id+"_preview_image.active"),t=e("."+this.element.id+"_preview_image.download");i.hasClass("download")||(this.options.nameable&&(i.find(".nameable").removeAttr("name"),t.find(".nameable").removeAttr("disabled")),this._resetInput(),t.slideDown({duration:"slow",queue:!1,complete:function(){e(this).addClass("active")}}),i.slideUp({duration:"slow",queue:!1,complete:function(){e(this).remove()}}))},_onDelete:function(){var i=this,t=e("."+this.element.id+"_preview_image.download");this.isDeletable&&(this.$replaceButton.hide(),this.$addButton.show(),this.$deleteButton.parent().addClass("removed").end(),this.$deleteButton.addClass("disabled").hide("slide",{direction:"left",queue:!1,complete:function(){i.$deleteButton.parent().remove()}},"slow"),t.slideUp({duration:"slow",queue:!1,complete:function(){e(this).empty()}}),this.$deleteFlag.val(1),this.isDeletable=!1,this.isEmpty=!0)},_onPreviewImage:function(){var t=this,s=this.element.files[0];i.loadImage(s,function(i){var n=e("."+t.element.id+"_preview_image.active"),a=n.clone().empty().hide().removeClass("download").addClass("upload");if(t.options.nameable){n.find(".nameable").attr("disabled","disabled");var o=e("<div/>").addClass("row").html(e("<input/>").attr("type","text").addClass("nameable").attr("name",t.options.widget_name+"[name]").val(s.name))}else var o=e("<div/>").addClass("row").text(s.name);var l=e("<div/>").addClass("row").text(t._bytesToSize(s.size));a.appendTo(n.parent()).html(e(i).addClass("img-polaroid")).append(o).append(l),a.slideDown({duration:"slow",queue:!1,complete:function(){e(this).addClass("active")}}),n.slideUp({duration:"slow",queue:!1,complete:function(){e(this).hasClass("download")?e(this).removeClass("active"):e(this).remove()}})},{maxWidth:t.options.maxWidth,maxHeight:t.options.maxHeight,minWidth:t.options.minWidth,minHeight:t.options.minHeight,canvas:t.options.previewAsCanvas,noRevoke:!0})},_onPreviewFile:function(){var i=e("."+this.element.id+"_preview_image.active"),t=i.clone().empty().hide().removeClass("download").addClass("upload"),s=this.element.files[0],n=this._checkFileType(s),a=e("<div/>").addClass("fileicon").addClass(n).html(this.options.filetypes[n]);if(this.options.nameable){i.find(".nameable").attr("disabled","disabled");var o=e("<div/>").addClass("row").html(e("<input/>").attr("type","text").addClass("nameable").attr("name",this.options.widget_name+"[name]").val(s.name))}else var o=e("<div/>").addClass("row").text(s.name);var l=e("<div/>").addClass("row").text(this._bytesToSize(s.size));t.appendTo(i.parent()).html(a).append(o).append(l),t.slideDown({duration:"slow",queue:!1,complete:function(){e(this).addClass("active")}}),i.slideUp({duration:"slow",queue:!1,complete:function(){e(this).hasClass("download")?e(this).removeClass("active"):e(this).remove()}})},_bytesToSize:function(e){var i=1024,t=1024*i,s=1024*t,n=1024*s;return i>e?e+" B":t>e?(e/i).toFixed(2)+" KB":s>e?(e/t).toFixed(2)+" MB":n>e?(e/s).toFixed(2)+" GB":(e/n).toFixed(2)+" TB"},_checkFileType:function(e){return this._isAudio(e)?"audio":this._isArchive(e)?"archive":this._isHTML(e)?"html":this._isImage(e)?"image":this._isPDFDocument(e)?"pdf-document":this._isPlainText(e)?"plain-text":this._isPresentation(e)?"presentation":this._isSpreadsheet(e)?"spreadsheet":this._isTextDocument(e)?"text-document":this._isVideo(e)?"video":"unknown"},_isAudio:function(e){return this._isFileType(e,"audio/.*")},_isArchive:function(e){return this._isFileType(e,"application/.*compress.*")||this._isFileType(e,"application/.*archive.*")||this._isFileType(e,"application/.*zip.*")||this._isFileType(e,"application/.*tar.*")||this._isFileType(e,"application/x-ace")||this._isFileType(e,"application/x-bz2")||this._isFileType(e,"gzip/document")},_isHTML:function(e){return this._isFileType(e,"text/html")},_isImage:function(e){return this._isFileType(e,"image/.*")},_isPDFDocument:function(e){return this._isFileType(e,"application/acrobat")||this._isFileType(e,"applications?/.*pdf.*")||this._isFileType(e,"text/.*pdf.*")},_isPlainText:function(e){return this._isFileType(e,"text/plain")},_isPresentation:function(e){return this._isFileType(e,"application/.*ms-powerpoint.*")||this._isFileType(e,"application/.*officedocument.presentationml.*")||this._isFileType(e,"application/.*opendocument.presentation.*")},_isSpreadsheet:function(e){return this._isFileType(e,"application/.*ms-excel.*")||this._isFileType(e,"application/.*officedocument.spreadsheetml.*")||this._isFileType(e,"application/.*opendocument.spreadsheet.*")},_isTextDocument:function(e){return this._isFileType(e,"application/.*ms-?word.*")||this._isFileType(e,"application/.*officedocument.wordprocessingml.*")||this._isFileType(e,"application/.*opendocument.text.*")},_isVideo:function(e){return this._isFileType(e,"video/.*")},_isFileType:function(e,i){return e&&e.type.match(i)},_resetInput:function(){var i=e(this.element).val("").clone(!0);e(this.element).replaceWith(i),this.element=i[0]}},e.fn[n]=function(i){var a=arguments;if(i===t||"object"==typeof i)return this.each(function(){e.data(this,"plugin_"+n)||e.data(this,"plugin_"+n,new s(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var o;return this.each(function(){var t=e.data(this,"plugin_"+n);t instanceof s&&"function"==typeof t[i]&&(o=t[i].apply(t,Array.prototype.slice.call(a,1))),"destroy"===i&&e.data(this,"plugin_"+n,null)}),o!==t?o:this}}}(jQuery,window);
